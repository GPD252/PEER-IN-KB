<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Secure Messenger 2025</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --green: #238636; --blue: #1f6feb; --text: #c9d1d9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { width: 90%; max-width: 400px; background: var(--card); padding: 30px; border-radius: 15px; border: 1px solid #30363d; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; }
        .tab-group { display: flex; margin-bottom: 20px; border-bottom: 1px solid #333; }
        .tab { flex: 1; padding: 10px; cursor: pointer; opacity: 0.5; transition: 0.3s; }
        .tab.active { opacity: 1; border-bottom: 3px solid var(--blue); font-weight: bold; }
        input { width: 100%; background: #0d1117; border: 1px solid #30363d; color: white; padding: 12px; margin-bottom: 15px; border-radius: 8px; box-sizing: border-box; font-size: 16px; outline: none; }
        button { width: 100%; padding: 14px; border-radius: 8px; border: none; color: white; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 16px; background: var(--green); }
        button:hover { opacity: 0.9; transform: translateY(-2px); }
        button:active { transform: translateY(0); }
        .hidden { display: none; }
        #chat-box { height: 280px; overflow-y: auto; background: #0d1117; border: 1px solid #30363d; padding: 10px; margin-top: 15px; text-align: left; border-radius: 8px; font-size: 14px; }
        .msg { margin-bottom: 8px; padding: 5px 10px; border-radius: 5px; background: #21262d; width: fit-content; }
    </style>
</head>
<body>

<div class="container">
    <!-- AUTH SCREEN -->
    <div id="auth-screen">
        <h2>üîê Secure Access</h2>
        <div class="tab-group">
            <div id="t-login" class="tab active" onclick="setTab('login')">Login</div>
            <div id="t-reg" class="tab" onclick="setTab('register')">Register</div>
        </div>
        <input type="text" id="username" placeholder="Username (ID)">
        <input type="password" id="password" placeholder="Password">
        <button id="main-btn" onclick="handleAuth()">Enter Messenger</button>
    </div>

    <!-- CHAT SCREEN -->
    <div id="chat-screen" class="hidden">
        <h3>Namaste, <span id="user-display" style="color:var(--green)"></span></h3>
        <p style="font-size:11px; color:#8b949e;">ID-Persistent Chat History Enabled</p>
        <div id="chat-box"></div>
        <div style="display:flex; gap:5px; margin-top:10px;">
            <input type="text" id="msg-input" placeholder="Type message..." style="margin:0;">
            <button onclick="sendMsg()" style="width:80px; background:var(--blue); padding:0;">Send</button>
        </div>
        <button onclick="location.reload()" style="background:#da3633; margin-top:10px; font-size:12px; padding:8px;">Logout</button>
    </div>
</div>

<script>
    let mode = 'login';
    let currentUser = "";

    function setTab(t) {
        mode = t;
        document.getElementById('t-login').className = t === 'login' ? 'tab active' : 'tab';
        document.getElementById('t-reg').className = t === 'register' ? 'tab active' : 'tab';
        document.getElementById('main-btn').innerText = t === 'login' ? 'Login Now' : 'Register & Create';
    }

    // Is baar buttons direct kaam karenge (No Server Delay)
    function handleAuth() {
        const u = document.getElementById('username').value.trim();
        const p = document.getElementById('password').value;

        if (!u || !p) {
            alert("Kripya ID aur Password dalein!");
            return;
        }

        if (mode === 'register') {
            if (localStorage.getItem("u_" + u)) {
                alert("Yeh Username pehle se hai! Login karein.");
            } else {
                localStorage.setItem("u_" + u, p);
                alert("Registration Successful! Ab Login karein.");
                setTab('login');
            }
        } else {
            const savedPass = localStorage.getItem("u_" + u);
            if (savedPass && savedPass === p) {
                currentUser = u;
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('chat-screen').classList.remove('hidden');
                document.getElementById('user-display').innerText = currentUser;
                loadHistory();
            } else {
                alert("Galat ID ya Password!");
            }
        }
    }

    function sendMsg() {
        const inp = document.getElementById('msg-input');
        if (!inp.value) return;

        const history = JSON.parse(localStorage.getItem("h_" + currentUser) || "[]");
        history.push({ s: "Main", t: inp.value });
        localStorage.setItem("h_" + currentUser, JSON.stringify(history));

        appendMsg("Main", inp.value);
        inp.value = "";
    }

    function loadHistory() {
        const history = JSON.parse(localStorage.getItem("h_" + currentUser) || "[]");
        history.forEach(m => appendMsg(m.s, m.t));
    }

    function appendMsg(s, t) {
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = 'msg';
        div.innerHTML = `<b>${s}:</b> ${t}`;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }
</script>
</body>
</html>
