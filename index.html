<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Private Chat 2025</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --green: #238636; --blue: #1f6feb; --text: #c9d1d9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { width: 90%; max-width: 400px; background: var(--card); padding: 30px; border-radius: 15px; border: 1px solid #30363d; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; }
        input { width: 100%; background: #0d1117; border: 1px solid #30363d; color: white; padding: 12px; margin-bottom: 15px; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 12px; border-radius: 8px; border: none; color: white; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 16px; }
        .reg-btn { background: var(--blue); }
        .login-btn { background: var(--green); }
        button:hover { opacity: 0.8; transform: scale(1.02); }
        .hidden { display: none; }
        #chat-box { height: 250px; overflow-y: auto; background: #0d1117; border: 1px solid #30363d; padding: 10px; margin-top: 15px; text-align: left; border-radius: 8px; }
        .status { font-size: 12px; color: #8b949e; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container" id="main-box">
    <!-- AUTH SCREEN -->
    <div id="auth-screen">
        <h2>üîê Private Messenger</h2>
        <p class="status">Kripya Register karein ya Login karein</p>
        <input type="text" id="username" placeholder="Username (ID)">
        <input type="password" id="password" placeholder="Password">
        <div class="btn-group">
            <button class="reg-btn" onclick="register()">Register</button>
            <button class="login-btn" onclick="login()">Login</button>
        </div>
    </div>

    <!-- CHAT SCREEN -->
    <div id="chat-screen" class="hidden">
        <h3>Namaste, <span id="user-display" style="color:var(--green)"></span></h3>
        <p style="font-size:12px;">P2P Chatting Enabled (No Server)</p>
        <div id="chat-box"></div>
        <input type="text" id="msg-input" placeholder="Message likhein..." style="margin-top:10px;">
        <button class="login-btn" style="width:100%" onclick="sendMsg()">Bhejein</button>
        <button class="reg-btn" style="width:100%; margin-top:5px; background:#da3633;" onclick="location.reload()">Logout</button>
    </div>
</div>

<script>
    let currentUser = "";

    // REGISTER FUNCTION
    function register() {
        const u = document.getElementById('username').value.trim();
        const p = document.getElementById('password').value;
        if (!u || !p) return alert("ID aur Password bhariye!");

        if (localStorage.getItem("user_" + u)) {
            alert("Yeh ID pehle se hai! Login karein.");
        } else {
            localStorage.setItem("user_" + u, p);
            alert("Registration Safal! Ab Login button dabayein.");
        }
    }

    // LOGIN FUNCTION
    function login() {
        const u = document.getElementById('username').value.trim();
        const p = document.getElementById('password').value;
        const savedPw = localStorage.getItem("user_" + u);

        if (savedPw && savedPw === p) {
            currentUser = u;
            startApp();
        } else {
            alert("Galat ID ya Password!");
        }
    }

    // APP START
    function startApp() {
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('chat-screen').classList.remove('hidden');
        document.getElementById('user-display').innerText = currentUser;
        loadChats();
    }

    // SEND MESSAGE
    function sendMsg() {
        const inp = document.getElementById('msg-input');
        if (!inp.value) return;

        const chatKey = "chats_" + currentUser;
        let chats = JSON.parse(localStorage.getItem(chatKey) || "[]");
        chats.push({ sender: "Main", text: inp.value });
        localStorage.setItem(chatKey, JSON.stringify(chats));

        appendChat("Main", inp.value);
        inp.value = "";
    }

    // LOAD HISTORY
    function loadChats() {
        const chats = JSON.parse(localStorage.getItem("chats_" + currentUser) || "[]");
        chats.forEach(c => appendChat(c.sender, c.text));
    }

    function appendChat(s, t) {
        const box = document.getElementById('chat-box');
        box.innerHTML += `<div><b>${s}:</b> ${t}</div>`;
        box.scrollTop = box.scrollHeight;
    }
</script>
</body>
</html>
